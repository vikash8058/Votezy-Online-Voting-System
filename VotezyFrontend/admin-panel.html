<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votezy Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #f7fafd;
            line-height: 1.6;
            color: #333;
        }

        /* Header */
        .admin-header {
            background: linear-gradient(90deg, #3498db 80%, #5dade2 100%);
            color: #fff;
            padding: 1rem 2rem;
            box-shadow: 0 2px 12px rgba(52,152,219,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .logo-section h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .admin-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .home-btn {
            background: rgba(255,255,255,0.15);
        }

        .logout-btn {
            background: rgba(231, 76, 60, 0.8);
        }

        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.9);
        }

        /* Header Messages Container */
        .header-messages {
            background: #fff;
            border-left: 4px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 0 2rem;
            border-radius: 0 0 8px 8px;
            position: relative;
            z-index: 999;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            transform: translateY(-2px);
        }

        .header-messages.compact {
            background: none;
            box-shadow: none;
            border-radius: 0;
            margin: 0;
            max-width: 350px;
            margin-left: auto;
            margin-right: 2rem;
            position: absolute;
            top: 70px;
            right: 0;
            z-index: 1001;
        }

        .header-message {
            padding: 0.5rem 1rem;
            font-size: 0.92rem;
            margin-bottom: 0.3rem;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: none;
            position: relative;
            min-width: 220px;
            max-width: 350px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-message.success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .header-message.error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .header-message.warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .header-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }

        .header-message .close-btn {
            position: absolute;
            top: 0.4rem;
            right: 0.7rem;
            font-size: 1rem;
            cursor: pointer;
            color: inherit;
            opacity: 0.3;
            background: none;
            border: none;
            transition: opacity 0.2s;
            z-index: 2;
        }

        .header-message .close-btn:hover {
            opacity: 0.7;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
            100% { transform: translateX(0); }
        }
        .header-message.shake {
            animation: shake 0.6s;
        }

        /* Navigation */
        .nav-tabs {
            background: #fff;
            border-bottom: 1px solid #e3eaf7;
            padding: 0 2rem;
            box-shadow: 0 2px 8px rgba(52,152,219,0.05);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 0;
        }

        .nav-tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            background: #f8fafc;
            color: #3498db;
        }

        .nav-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: #f8fafc;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            color: #222;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .section-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Cards */
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(52,152,219,0.08);
            margin-bottom: 2rem;
            border: 1px solid #e3eaf7;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #eaf6ff 60%, #f7fafd 100%);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e3eaf7;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #3498db;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .card-content {
            padding: 2rem;
        }

        /* Countdown Timer Styles */
        .countdown-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .countdown-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .countdown-unit {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem 0.8rem;
            min-width: 80px;
            backdrop-filter: blur(10px);
        }

        .countdown-number {
            font-size: 2.2rem;
            font-weight: 700;
            display: block;
            line-height: 1;
        }

        .countdown-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.3rem;
        }

        .countdown-status {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-top: 0.5rem;
        }

        .countdown-ended {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .countdown-active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%) !important;
        }

        .countdown-active .countdown-title {
            color: #fff;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e3eaf7;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #3498db;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* Action Buttons */
        .edit-btn, .delete-btn, .candidate-edit-btn, .candidate-delete-btn {
            padding: 0.4rem 0.8rem;
            margin: 0 0.2rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .edit-btn, .candidate-edit-btn {
            background: #3498db;
            color: white;
        }

        .edit-btn:hover, .candidate-edit-btn:hover {
            background: #2980b9;
        }

        .edit-btn:disabled, .candidate-edit-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .delete-btn, .candidate-delete-btn {
            background: #e74c3c;
            color: white;
        }

        .delete-btn:hover, .candidate-delete-btn:hover {
            background: #c0392b;
        }

        .delete-btn:disabled, .candidate-delete-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        #election-form .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(3, auto);
            gap: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 600;
            color: #444;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-input {
            padding: 0.8rem 1rem;
            border: 1px solid #d0d7de;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: #fff;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }

        .btn-primary {
            background: linear-gradient(90deg, #3498db 80%, #5dade2 100%);
            color: #fff;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(52,152,219,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52,152,219,0.3);
        }

        .btn-secondary {
            background: #fff;
            color: #3498db;
            border: 1px solid #3498db;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 1rem;
        }

        .btn-secondary:hover {
            background: #3498db;
            color: #fff;
        }

        /* Status and Control Buttons */
        .status-control-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e3eaf7;
            flex-wrap: wrap;
        }

        .btn-status {
            background: #95a5a6;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: default;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-status.inactive {
            background: #e74c3c;
        }

        .btn-status.active {
            background: #27ae60;
        }

        .btn-status.completed {
            background: #8e44ad;
        }

        .btn-declare-result {
            background: linear-gradient(90deg, #f39c12 0%, #e67e22 100%);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-declare-result:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243,156,18,0.3);
        }

        .btn-declare-result:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-declare-result:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .btn-declare-result.permanently-disabled {
            background: #27ae60 !important;
            cursor: default !important;
            opacity: 1 !important;
        }

        .btn-declare-result.permanently-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        /* View Results Button */
        .btn-view-results {
            background: linear-gradient(90deg, #8e44ad 0%, #9b59b6 100%);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-view-results:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142,68,173,0.3);
        }

        .btn-view-results:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-view-results:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .btn-view-results.permanently-enabled {
            background: linear-gradient(90deg, #8e44ad 0%, #9b59b6 100%) !important;
            cursor: pointer !important;
            opacity: 1 !important;
        }

        .btn-view-results.permanently-enabled:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(142,68,173,0.3) !important;
        }

        /* Reset button specific styling */
        .btn-reset {
            background: #e74c3c;
            color: #fff;
            border: 1px solid #e74c3c;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 0rem;
        }

        .btn-reset:hover {
            background: #c0392b;
            border-color: #c0392b;
        }

        .btn-reset:disabled {
            background: #bdc3c7;
            border-color: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #fff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(52,152,219,0.08);
            border: 1px solid #e3eaf7;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .stat-card.loading {
            opacity: 0.7;
        }

        .stat-card.loading::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .stat-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .last-updated {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
            color: #999;
            background: rgba(255,255,255,0.8);
            padding: 2px 5px;
            border-radius: 3px;
        }

        /* Election Settings */
        .election-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-completed {
            background: #e2e3f0;
            color: #6f42c1;
        }

        /* Modal Styles */
        #modalOverlay, #candidateModalOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 999;
        }

        #editModal, #editCandidateModal {
            display: none;
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 300px;
        }

        #editModal h3, #editCandidateModal h3 {
            margin-bottom: 1rem;
            color: #3498db;
        }

        #editModal label, #editCandidateModal label {
            display: block;
            margin: 0.5rem 0 0.2rem 0;
            font-weight: 500;
        }

        #editModal input, #editCandidateModal input, #editCandidateModal select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        #editModal div, #editCandidateModal div {
            display: flex;
            justify-content: space-between;
        }

        #editModal button, #editCandidateModal button {
            width: 48%;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        #editModal button[type="submit"], #editCandidateModal button[type="submit"] {
            background: #3498db;
            color: white;
        }

        #editModal button[type="button"], #editCandidateModal button[type="button"] {
            background: #95a5a6;
            color: white;
        }

        /* Delete Confirmation Modal */
        .delete-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2500;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .delete-modal.active {
            display: flex;
        }

        .delete-modal-content {
            background: #fff;
            border-radius: 16px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 16px 64px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .delete-modal-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            padding: 1.5rem 2rem;
            text-align: center;
        }

        .delete-modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .delete-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .delete-modal-body {
            padding: 2rem;
            text-align: center;
        }

        .delete-message {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .delete-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirm-delete-btn {
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .confirm-delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231,76,60,0.3);
        }

        .cancel-delete-btn {
            background: #6c757d;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-delete-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Logout Modal Styles */
        .logout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2500;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .logout-modal.active {
            display: flex;
        }

        .logout-modal-content {
            background: #fff;
            border-radius: 16px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 16px 64px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .logout-modal-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            padding: 1.5rem 2rem;
            text-align: center;
        }

        .logout-modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .logout-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .logout-modal-body {
            padding: 2rem;
            text-align: center;
        }

        .logout-message {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .logout-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirm-logout-btn {
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .confirm-logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231,76,60,0.3);
        }

        .cancel-logout-btn {
            background: #6c757d;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-logout-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .user-section {
                flex-wrap: wrap;
                justify-content: center;
            }

            .header-messages {
                margin: 0 1rem;
            }

            .nav-tabs {
                padding: 0 1rem;
            }

            .nav-container {
                flex-direction: column;
            }

            .nav-tab {
                padding: 0.8rem 1rem;
                border-bottom: none;
                border-left: 3px solid transparent;
            }

            .nav-tab.active {
                border-left-color: #3498db;
                border-bottom-color: transparent;
            }

            .main-content {
                padding: 1rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .card-content {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.9rem;
            }

            .logout-buttons {
                flex-direction: column;
            }

            .logout-modal-content {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }

            .logout-modal-body {
                padding: 1rem;
            }

            .delete-buttons {
                flex-direction: column;
            }

            .delete-modal-content {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }

            .delete-modal-body {
                padding: 1rem;
            }

            .status-control-container {
                flex-direction: column;
                align-items: stretch;
            }

            .countdown-display {
                gap: 0.8rem;
            }

            .countdown-unit {
                min-width: 60px;
                padding: 0.8rem 0.5rem;
            }

            .countdown-number {
                font-size: 1.8rem;
            }
        }

        /* Flag Icon */
        .flag-icon {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="logo-section">
                <span class="flag-icon">
                    <svg width="32" height="20" viewBox="0 0 32 20" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="6.67" y="0" fill="#FF9933"/>
                        <rect width="32" height="6.67" y="6.67" fill="#FFFFFF"/>
                        <rect width="32" height="6.66" y="13.34" fill="#138808"/>
                        <circle cx="16" cy="10" r="2.2" fill="none" stroke="#000088" stroke-width="0.7"/>
                        <g stroke="#000088" stroke-width="0.3">
                            <g>
                                <line x1="16" y1="7.8" x2="16" y2="12.2"/>
                                <line x1="13.8" y1="10" x2="18.2" y2="10"/>
                            </g>
                            <g transform="rotate(45 16 10)">
                                <line x1="16" y1="7.8" x2="16" y2="12.2"/>
                                <line x1="13.8" y1="10" x2="18.2" y2="10"/>
                            </g>
                        </g>
                    </svg>
                </span>
                <h1>Votezy</h1>
                <span class="admin-badge">Admin Panel</span>
            </div>
            <div class="user-section">
                <span>Welcome, System Administrator</span>
                <a href="index.html" class="header-btn home-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    Home
                </a>
                <button class="header-btn logout-btn" onclick="showLogoutConfirmation()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
        <!-- Compact header-messages box -->
        <div class="header-messages compact">
            <div id="header-success-message" class="header-message success">
                <button class="close-btn" onclick="hideHeaderMessage('header-success-message')">&times;</button>
                <span class="message-text"></span>
            </div>
            <div id="header-error-message" class="header-message error">
                <button class="close-btn" onclick="hideHeaderMessage('header-error-message')">&times;</button>
                <span class="message-text"></span>
            </div>
            <div id="header-warning-message" class="header-message warning">
                <button class="close-btn" onclick="hideHeaderMessage('header-warning-message')">&times;</button>
                <span class="message-text"></span>
            </div>
            <div id="header-info-message" class="header-message info">
                <button class="close-btn" onclick="hideHeaderMessage('header-info-message')">&times;</button>
                <span class="message-text"></span>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <div class="nav-container">
            <div class="nav-tab active" data-section="voters">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Voter Details
            </div>
            <div class="nav-tab" data-section="candidates">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="7" r="4"/>
                    <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                    <path d="M15 11l2 2l4 -4"/>
                </svg>
                Candidate Details
            </div>
            <div class="nav-tab" data-section="election">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Election Settings
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Voter Details Section -->
        <section id="voters" class="content-section active">
            <div class="section-header">
                <h2 class="section-title">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Voter Management
                </h2>
                <p class="section-subtitle">View and manage registered voters</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card" id="total-voters-card">
                    <div class="last-updated" id="total-voters-updated"></div>
                    <div class="stat-value" id="total-voters-value">Loading...</div>
                    <div class="stat-label">Total Registered Voters</div>
                    <div class="stat-error" id="total-voters-error" style="display: none;"></div>
                </div>
                <div class="stat-card" id="voted-successfully-card">
                    <div class="last-updated" id="voted-successfully-updated"></div>
                    <div class="stat-value" id="voted-successfully-value">Loading...</div>
                    <div class="stat-label">Voted successfully</div>
                    <div class="stat-error" id="voted-successfully-error" style="display: none;"></div>
                </div>
                <div class="stat-card" id="havent-voted-card">
                    <div class="last-updated" id="havent-voted-updated"></div>
                    <div class="stat-value" id="havent-voted-value">Loading...</div>
                    <div class="stat-label">Haven't voted</div>
                    <div class="stat-error" id="havent-voted-error" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Registered Voters
                    </h3>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Voter ID</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Has Voted</th>
                                    <th>Manage Account</th>
                                </tr>
                            </thead>
                            <tbody id="voterTableBody">
                                <!-- Dynamic rows here -->
                            </tbody>
                        </table>

                        <!-- Modal Overlay -->
                        <div id="modalOverlay"></div>

                        <!-- Edit Modal -->
                        <div id="editModal">
                            <h3>Edit Voter</h3>
                            <form id="editForm">
                                <input type="hidden" id="editVoterId" />
                                <label for="editFullName">Full Name</label>
                                <input type="text" id="editFullName" required />
                                <label for="editUsername">Username (Email)</label>
                                <input type="email" id="editUsername" required />
                                <div>
                                    <button type="submit">Save</button>
                                    <button type="button" id="cancelBtn">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Candidate Details Section -->
        <section id="candidates" class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2">
                        <circle cx="12" cy="7" r="4"/>
                        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                        <path d="M15 11l2 2l4 -4"/>
                    </svg>
                    Candidate Management
                </h2>
                <p class="section-subtitle">View and manage election candidates</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card" id="total-candidates-card">
                    <div class="last-updated" id="total-candidates-updated"></div>
                    <div class="stat-value" id="total-candidates-value">Loading...</div>
                    <div class="stat-label">Total Candidates</div>
                    <div class="stat-error" id="total-candidates-error" style="display: none;"></div>
                </div>
                <div class="stat-card" id="completed-profiles-card">
                    <div class="last-updated" id="completed-profiles-updated"></div>
                    <div class="stat-value" id="completed-profiles-value">Loading...</div>
                    <div class="stat-label">Profile Completed</div>
                    <div class="stat-error" id="completed-profiles-error" style="display: none;"></div>
                </div>
                <div class="stat-card" id="incomplete-profiles-card">
                    <div class="last-updated" id="incomplete-profiles-updated"></div>
                    <div class="stat-value" id="incomplete-profiles-value">Loading...</div>
                    <div class="stat-label">Profile Incompleted</div>
                    <div class="stat-error" id="incomplete-profiles-error" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="7" r="4"/>
                            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                        </svg>
                        Registered Candidates
                    </h3>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Candidate ID</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Party Name</th>
                                    <th>Symbol</th>
                                    <th>Status</th>
                                    <th>Vote Count</th>
                                    <th>Manage Account</th>
                                </tr>
                            </thead>
                            <tbody id="candidateTableBody">
                                <!-- Dynamic rows here -->
                            </tbody>
                        </table>

                        <!-- Candidate Modal Overlay -->
                        <div id="candidateModalOverlay"></div>

                        <!-- Edit Candidate Modal -->
                        <div id="editCandidateModal">
                            <h3>Edit Candidate</h3>
                            <form id="editCandidateForm">
                                <input type="hidden" id="editCandidateId" />
                                <label for="editCandidateName">Full Name</label>
                                <input type="text" id="editCandidateName" required />
                                <label for="editCandidateUsername">Username (Email)</label>
                                <input type="email" id="editCandidateUsername" required />
                                <div>
                                    <button type="submit">Save</button>
                                    <button type="button" id="cancelCandidateBtn">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Election Settings Section -->
        <section id="election" class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Election Configuration
                </h2>
                <p class="section-subtitle">Configure election settings and schedule</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                        </svg>
                        Election Details
                    </h3>
                </div>
                <div class="card-content">
                    <form id="election-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="election-name">Election Name</label>
                                <input type="text" id="election-name" name="election-name" class="form-input" placeholder="Enter election name (e.g., General Elections 2024)">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="election-type">Election Type</label>
                                <select id="election-type" name="election-type" class="form-input">
                                    <option value="general">General Election</option>
                                    <option value="local">Local Election</option>
                                    <option value="by-election">By-Election</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="start-date">Start Date</label>
                                <input type="date" id="start-date" name="start-date" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="end-date">End Date</label>
                                <input type="date" id="end-date" name="end-date" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="start-time">Start Time</label>
                                <input type="time" id="start-time" name="start-time" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="end-time">End Time</label>
                                <input type="time" id="end-time" name="end-time" class="form-input">
                            </div>
                        </div>
                        <!-- Hardcoded description/instruction below the grid -->
                        <div class="form-group">
                            <label class="form-label">
                                Election Description & Instructions
                            </label>
                            <div style="background:#f8fafc;padding:1rem;border-radius:8px;border:1px solid #e3eaf7;color:#444;">
                                Please participate in the election responsibly. Eligible voters can cast their votes online during the specified time period. Make sure to review all candidate details before submitting your vote. For any issues, contact the election administrator.
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn-primary">
                                Save Election Settings
                            </button>
                            <button type="button" class="btn-reset" id="reset-form-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12a9 9 0 1 0 3-7.3L6 5"/>
                                    <path d="M6 2v3h3"/>
                                </svg>
                                Reset Settings
                            </button>
                        </div>
                    </form>
                    
                    <!-- Countdown Timer - Moved below the Reset Settings button -->
                    <div class="countdown-container" id="countdown-container" style="display: none;">
                        <div class="countdown-title" id="countdown-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                            Election Countdown
                        </div>
                        <div class="countdown-display" id="countdown-display">
                            <div class="countdown-unit">
                                <span class="countdown-number" id="days">00</span>
                                <div class="countdown-label">Days</div>
                            </div>
                            <div class="countdown-unit">
                                <span class="countdown-number" id="hours">00</span>
                                <div class="countdown-label">Hours</div>
                            </div>
                            <div class="countdown-unit">
                                <span class="countdown-number" id="minutes">00</span>
                                <div class="countdown-label">Minutes</div>
                            </div>
                            <div class="countdown-unit">
                                <span class="countdown-number" id="seconds">00</span>
                                <div class="countdown-label">Seconds</div>
                            </div>
                        </div>
                        <div class="countdown-status" id="countdown-status">Time remaining until election ends</div>
                    </div>
                    
                    <!-- Status Control Container with Status Indicator and Control Buttons -->
                    <div class="status-control-container">
                        <div class="btn-status inactive" id="status-indicator">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" y1="9" x2="9" y2="15"/>
                                <line x1="9" y1="9" x2="15" y2="15"/>
                            </svg>
                            Election Inactive
                        </div>
                        <button type="button" class="btn-declare-result" id="declare-result-btn" disabled>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3L22 4"/>
                                <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.5 0 2.91.37 4.15 1.02"/>
                            </svg>
                            Declare Results
                        </button>
                        <button type="button" class="btn-view-results" id="view-results-btn" disabled>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            View Results
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Delete Confirmation Modal -->
    <div class="delete-modal" id="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h3 class="delete-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                    Delete Voter
                </h3>
                <p class="delete-modal-subtitle">This action cannot be undone</p>
            </div>
            <div class="delete-modal-body">
                <p class="delete-message" id="delete-confirmation-message">
                    Are you sure you want to delete this voter? This action is permanent and cannot be reversed.
                </p>
                <div class="delete-buttons">
                    <button class="confirm-delete-btn" id="confirm-delete-btn" onclick="executeDelete()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        </svg>
                        Yes, Delete
                    </button>
                    <button class="cancel-delete-btn" onclick="cancelDelete()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Candidate Delete Confirmation Modal -->
    <div class="delete-modal" id="candidate-delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h3 class="delete-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                    Delete Candidate
                </h3>
                <p class="delete-modal-subtitle">This action cannot be undone</p>
            </div>
            <div class="delete-modal-body">
                <p class="delete-message" id="candidate-delete-confirmation-message">
                    Are you sure you want to delete this candidate? This action is permanent and cannot be reversed.
                </p>
                <div class="delete-buttons">
                    <button class="confirm-delete-btn" id="confirm-candidate-delete-btn" onclick="executeCandidateDelete()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        </svg>
                        Yes, Delete
                    </button>
                    <button class="cancel-delete-btn" onclick="cancelCandidateDelete()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="logout-modal" id="logout-modal">
        <div class="logout-modal-content">
            <div class="logout-modal-header">
                <h3 class="logout-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                    </svg>
                    Confirm Logout
                </h3>
                <p class="logout-modal-subtitle">You are about to leave the Admin Panel</p>
            </div>
            <div class="logout-modal-body">
                <p class="logout-message">
                    Are you sure you want to logout? You will need to enter your credentials again to access the admin panel.
                </p>
                <div class="logout-buttons">
                    <button class="confirm-logout-btn" onclick="confirmLogout()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Yes, Logout
                    </button>
                    <button class="cancel-logout-btn" onclick="cancelLogout()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Confirmation Modal -->
    <div class="delete-modal" id="edit-confirm-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3 class="delete-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20v-6M12 4v2m0 0a8 8 0 1 1 0 16a8 8 0 1 1 0-16z"/>
                    </svg>
                    Confirm Edit
                </h3>
                <p class="delete-modal-subtitle">Please confirm your changes</p>
            </div>
            <div class="delete-modal-body">
                <p class="delete-message" id="edit-confirmation-message">
                    Are you sure you want to save these changes to the voter's details?
                </p>
                <div class="delete-buttons">
                    <button class="confirm-delete-btn" id="confirm-edit-btn">
                        Yes, Save Changes
                    </button>
                    <button class="cancel-delete-btn" id="cancel-edit-btn">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Candidate Edit Confirmation Modal -->
    <div class="delete-modal" id="candidate-edit-confirm-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3 class="delete-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20v-6M12 4v2m0 0a8 8 0 1 1 0 16a8 8 0 1 1 0-16z"/>
                    </svg>
                    Confirm Candidate Edit
                </h3>
                <p class="delete-modal-subtitle">Please confirm your changes</p>
            </div>
            <div class="delete-modal-body">
                <p class="delete-message" id="candidate-edit-confirmation-message">
                    Are you sure you want to save these changes to the candidate's details?
                </p>
                <div class="delete-buttons">
                    <button class="confirm-delete-btn" id="confirm-candidate-edit-btn">
                        Yes, Save Changes
                    </button>
                    <button class="cancel-delete-btn" id="cancel-candidate-edit-btn">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="delete-modal" id="reset-confirm-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h3 class="delete-modal-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 3-7.3L6 5"/>
                        <path d="M6 2v3h3"/>
                    </svg>
                    Reset Election Settings
                </h3>
                <p class="delete-modal-subtitle">This will clear all election configuration</p>
            </div>
            <div class="delete-modal-body">
                <p class="delete-message">
                    Are you sure you want to reset all election settings?<br><br>
                    <strong>This will:</strong><br>
                    • Clear all election configuration data from the database<br>
                    • Reset the form to default values<br>
                    • This action cannot be undone
                </p>
                <div class="delete-buttons">
                    <button class="confirm-delete-btn" id="confirm-reset-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 1 0 3-7.3L6 5"/>
                            <path d="M6 2v3h3"/>
                        </svg>
                        Yes, Reset Settings
                    </button>
                    <button class="cancel-delete-btn" id="cancel-reset-btn">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize voter management elements
        const apiBase = 'http://localhost:8080/api';
        const voterTableBody = document.getElementById('voterTableBody');
        const candidateTableBody = document.getElementById('candidateTableBody');
        
        // Voter modal elements
        const editModal = document.getElementById('editModal');
        const modalOverlay = document.getElementById('modalOverlay');
        const editForm = document.getElementById('editForm');
        const cancelBtn = document.getElementById('cancelBtn');
        const editVoterId = document.getElementById('editVoterId');
        const editFullName = document.getElementById('editFullName');
        const editUsername = document.getElementById('editUsername');
        
        // Candidate modal elements
        const editCandidateModal = document.getElementById('editCandidateModal');
        const candidateModalOverlay = document.getElementById('candidateModalOverlay');
        const editCandidateForm = document.getElementById('editCandidateForm');
        const cancelCandidateBtn = document.getElementById('cancelCandidateBtn');
        const editCandidateId = document.getElementById('editCandidateId');
        const editCandidateName = document.getElementById('editCandidateName');
        const editCandidateUsername = document.getElementById('editCandidateUsername');
        
        // Header Message elements
        const headerSuccessMessage = document.getElementById('header-success-message');
        const headerErrorMessage = document.getElementById('header-error-message');
        const headerWarningMessage = document.getElementById('header-warning-message');
        const headerInfoMessage = document.getElementById('header-info-message');

        // Delete modal elements
        const deleteModal = document.getElementById('delete-modal');
        const deleteConfirmationMessage = document.getElementById('delete-confirmation-message');
        let voterToDelete = null;

        // Candidate delete modal elements
        const candidateDeleteModal = document.getElementById('candidate-delete-modal');
        const candidateDeleteConfirmationMessage = document.getElementById('candidate-delete-confirmation-message');
        let candidateToDelete = null;

        // Reset modal elements
        const resetConfirmModal = document.getElementById('reset-confirm-modal');
        const confirmResetBtn = document.getElementById('confirm-reset-btn');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');
        const resetFormBtn = document.getElementById('reset-form-btn');

        // Election control elements
        const statusIndicator = document.getElementById('status-indicator');
        const declareResultBtn = document.getElementById('declare-result-btn');
        const viewResultsBtn = document.getElementById('view-results-btn');

        // Countdown elements
        const countdownContainer = document.getElementById('countdown-container');
        const countdownTitle = document.getElementById('countdown-title');
        const countdownDisplay = document.getElementById('countdown-display');
        const countdownStatus = document.getElementById('countdown-status');
        const daysElement = document.getElementById('days');
        const hoursElement = document.getElementById('hours');
        const minutesElement = document.getElementById('minutes');
        const secondsElement = document.getElementById('seconds');

        // Election status state
        let currentElectionStatus = 'inactive'; // inactive, active, completed
        let isElectionTimeEnded = false;
        let hasElectionSettings = false;
        let electionEndTime = null;
        let countdownInterval = null;
        let resultsAreDeclared = false;
        let electionStartTime = null; // ADD THIS LINE

        // Stats elements - Voter Stats
        const voterStatsElements = {
            totalVoters: {
                card: document.getElementById('total-voters-card'),
                value: document.getElementById('total-voters-value'),
                updated: document.getElementById('total-voters-updated'),
                error: document.getElementById('total-voters-error'),
                endpoint: '/total-voters'
            },
            votedSuccessfully: {
                card: document.getElementById('voted-successfully-card'),
                value: document.getElementById('voted-successfully-value'),
                updated: document.getElementById('voted-successfully-updated'),
                error: document.getElementById('voted-successfully-error'),
                endpoint: '/voted-successfully'
            },
            haventVoted: {
                card: document.getElementById('havent-voted-card'),
                value: document.getElementById('havent-voted-value'),
                updated: document.getElementById('havent-voted-updated'),
                error: document.getElementById('havent-voted-error'),
                endpoint: '/havent-voted'
            }
        };

        // Stats elements - Candidate Stats
        const candidateStatsElements = {
            totalCandidates: {
                card: document.getElementById('total-candidates-card'),
                value: document.getElementById('total-candidates-value'),
                updated: document.getElementById('total-candidates-updated'),
                error: document.getElementById('total-candidates-error'),
                endpoint: '/admin/candidates/stats/total'
            },
            completedProfiles: {
                card: document.getElementById('completed-profiles-card'),
                value: document.getElementById('completed-profiles-value'),
                updated: document.getElementById('completed-profiles-updated'),
                error: document.getElementById('completed-profiles-error'),
                endpoint: '/admin/candidates/stats/completed'
            },
            incompleteProfiles: {
                card: document.getElementById('incomplete-profiles-card'),
                value: document.getElementById('incomplete-profiles-value'),
                updated: document.getElementById('incomplete-profiles-updated'),
                error: document.getElementById('incomplete-profiles-error'),
                endpoint: '/admin/candidates/stats/incomplete'
            }
        };

        // Auto-refresh interval (30 seconds)
        let refreshInterval;
        const REFRESH_INTERVAL = 30000; // 30 seconds

        // Countdown Timer Functions
        // Enhanced Countdown Timer Functions (REPLACE EXISTING COUNTDOWN FUNCTIONS)
        function startCountdown() {
            if (!electionStartTime && !electionEndTime) return;

            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            countdownInterval = setInterval(updateCountdown, 1000);
            updateCountdown(); // Initial call
            countdownContainer.style.display = 'block';
        }

        function stopCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            countdownContainer.style.display = 'none';
        }

        function updateCountdown() {
            const now = new Date().getTime();
            
            // Before election starts
            if (electionStartTime && now < electionStartTime) {
                const timeLeft = electionStartTime - now;
                updateCountdownDisplay(timeLeft, 'starts');
                return;
            }
            
            // During election (between start and end)
            if (electionEndTime && now < electionEndTime) {
                const timeLeft = electionEndTime - now;
                updateCountdownDisplay(timeLeft, 'active');
                return;
            }
            
            // After election ends
            isElectionTimeEnded = true;
            showElectionEnded();
            updateElectionStatusDisplay();
            checkResultsStatus(); // Check if results can be declared
        }

        function updateCountdownDisplay(timeLeft, phase) {
            if (timeLeft <= 0) {
                if (phase === 'starts') {
                    // Election just started, switch to active phase
                    electionStartTime = null; // Clear start time
                    updateCountdown(); // Recursively call to handle active phase
                }
                return;
            }

            // Calculate time units
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            // Update display
            daysElement.textContent = String(days).padStart(2, '0');
            hoursElement.textContent = String(hours).padStart(2, '0');
            minutesElement.textContent = String(minutes).padStart(2, '0');
            secondsElement.textContent = String(seconds).padStart(2, '0');

            // Update title and status based on phase
            if (phase === 'starts') {
                countdownContainer.classList.remove('countdown-ended', 'countdown-active');
                countdownTitle.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    Election Starts In
                `;
                if (days > 0) {
                    countdownStatus.textContent = `Election starts in ${days} days, ${hours} hours`;
                } else if (hours > 0) {
                    countdownStatus.textContent = `Election starts in ${hours} hours, ${minutes} minutes`;
                } else if (minutes > 0) {
                    countdownStatus.textContent = `Election starts in ${minutes} minutes`;
                } else {
                    countdownStatus.textContent = `Election starts in ${seconds} seconds`;
                }
            } else if (phase === 'active') {
                countdownContainer.classList.remove('countdown-ended');
                countdownContainer.classList.add('countdown-active');
                countdownTitle.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    Election Time Remaining
                    <span style="background: #e74c3c; color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.8rem; margin-left: 1rem;">LIVE</span>
                `;
                if (days > 0) {
                    countdownStatus.textContent = `Election ends in ${days} days, ${hours} hours`;
                } else if (hours > 0) {
                    countdownStatus.textContent = `Election ends in ${hours} hours, ${minutes} minutes`;
                } else if (minutes > 0) {
                    countdownStatus.textContent = `Election ends in ${minutes} minutes`;
                } else {
                    countdownStatus.textContent = `Election ends in ${seconds} seconds`;
                }
            }
        }

        function showElectionEnded() {
            countdownContainer.classList.add('countdown-ended');
            countdownContainer.classList.remove('countdown-active');
            countdownTitle.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"/>
                    <circle cx="12" cy="12" r="10"/>
                </svg>
                Election Ended
                <span style="background: #95a5a6; color: white; padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.8rem; margin-left: 1rem;">ENDED</span>
            `;
            countdownStatus.textContent = 'Election period has ended. Results can now be declared.';
            
            // Set all countdown numbers to 00
            daysElement.textContent = '00';
            hoursElement.textContent = '00';
            minutesElement.textContent = '00';
            secondsElement.textContent = '00';
            
            // Stop the countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }

        function initializeCountdown() {
            const startDate = document.getElementById('start-date').value;
            const startTime = document.getElementById('start-time').value;
            const endDate = document.getElementById('end-date').value;
            const endTime = document.getElementById('end-time').value;
            
            if (startDate && startTime && endDate && endTime && currentElectionStatus === 'active') {
                electionStartTime = new Date(`${startDate}T${startTime}`).getTime();
                electionEndTime = new Date(`${endDate}T${endTime}`).getTime();
                
                const now = new Date().getTime();
                isElectionTimeEnded = now > electionEndTime;
                
                if (isElectionTimeEnded) {
                    showElectionEnded();
                    checkResultsStatus(); // Check if results can be declared
                } else {
                    // Reset countdown appearance
                    countdownContainer.classList.remove('countdown-ended');
                    startCountdown();
                }
            } else {
                stopCountdown();
            }
        }

        // Header message functions

        // Result Management Functions
        async function checkResultsStatus() {
            try {
                const response = await fetch(`${apiBase}/isResult/declared`);
                if (!response.ok) {
                    throw new Error('Failed to check results status');
                }
                
                const data = await response.json();
                const resultsDeclared = data.resultsDeclared || false;
                
                updateResultButtons(resultsDeclared);
                
                if (resultsDeclared) {
                    currentElectionStatus = 'completed';
                    resultsAreDeclared = true;
                    updateElectionStatusDisplay();
                }
                
                return resultsDeclared;
                
            } catch (error) {
                console.error('Error checking results status:', error);
                // On error, assume results not declared and disable buttons
                updateResultButtons(false);
                return false;
            }
        }

        function updateResultButtons(resultsDeclared) {
            if (resultsDeclared) {
                // Results are declared - permanently disable declare button, enable view results
                declareResultBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                    </svg>
                    Results Declared
                `;
                declareResultBtn.disabled = true;
                declareResultBtn.classList.add('permanently-disabled');
                declareResultBtn.style.background = '#27ae60';
                declareResultBtn.style.cursor = 'default';

                // Enable View Results button permanently
                viewResultsBtn.disabled = false;
                viewResultsBtn.classList.add('permanently-enabled');
                viewResultsBtn.style.background = 'linear-gradient(90deg, #8e44ad 0%, #9b59b6 100%)';
                viewResultsBtn.style.cursor = 'pointer';
                
            } else if (isElectionTimeEnded) {
                // Election ended but results not declared - enable declare button
                declareResultBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                        <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.5 0 2.91.37 4.15 1.02"/>
                    </svg>
                    Declare Results
                `;
                declareResultBtn.disabled = false;
                declareResultBtn.classList.remove('permanently-disabled');
                declareResultBtn.style.background = 'linear-gradient(90deg, #f39c12 0%, #e67e22 100%)';
                declareResultBtn.style.cursor = 'pointer';

                // Keep View Results disabled until results are declared
                viewResultsBtn.disabled = true;
                viewResultsBtn.classList.remove('permanently-enabled');
                viewResultsBtn.style.background = '#bdc3c7';
                viewResultsBtn.style.cursor = 'not-allowed';
                
            } else {
                // Election still active or not started - disable both buttons
                declareResultBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                        <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.5 0 2.91.37 4.15 1.02"/>
                    </svg>
                    Declare Results
                `;
                declareResultBtn.disabled = true;
                declareResultBtn.classList.remove('permanently-disabled');
                declareResultBtn.style.background = '#bdc3c7';
                declareResultBtn.style.cursor = 'not-allowed';

                viewResultsBtn.disabled = true;
                viewResultsBtn.classList.remove('permanently-enabled');
                viewResultsBtn.style.background = '#bdc3c7';
                viewResultsBtn.style.cursor = 'not-allowed';
            }
        }

        // Enhanced Declare Result Function
        async function declareResults() {
            if (!isElectionTimeEnded) {
                showErrorMessage('Results can only be declared after the election period has ended.');
                return;
            }

            if (currentElectionStatus !== 'active') {
                showErrorMessage('Results can only be declared for an active election.');
                return;
            }

            // Check current status first
            const currentStatus = await checkResultsStatus();
            if (currentStatus) {
                showWarningMessage('Results have already been declared.');
                return;
            }

            if (!confirm('Are you sure you want to declare the election results? This action will make the results public and cannot be undone.')) {
                return;
            }

            const originalText = declareResultBtn.innerHTML;
            declareResultBtn.disabled = true;
            declareResultBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                Declaring Results...
            `;

            try {
                const response = await fetch(`${apiBase}/admin/declare-results`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to declare results');
                }

                const data = await response.json();
                
                // Verify results were declared by checking API again
                const finalStatus = await checkResultsStatus();
                
                if (finalStatus) {
                    currentElectionStatus = 'completed';
                    resultsAreDeclared = true;
                    updateElectionStatusDisplay();
                    showSuccessMessage(data?.message || 'Election results have been declared successfully!');
                } else {
                    throw new Error('Results declaration may not have completed properly');
                }
                
            } catch (error) {
                console.error('Error declaring results:', error);
                showErrorMessage('Failed to declare results. Please try again.');
                
                // Restore button state on error
                declareResultBtn.disabled = false;
                declareResultBtn.innerHTML = originalText;
                
                // Double-check status in case it partially succeeded
                checkResultsStatus();
            }
        }

        // Enhanced View Results Function
        async function viewResults() {
            // Check current results status
            const resultsDeclared = await checkResultsStatus();
            
            if (!resultsDeclared && !viewResultsBtn.classList.contains('permanently-enabled')) {
                showErrorMessage('Results have not been declared yet.');
                return;
            }
            
            // Redirect to results page
            window.location.href = 'result.html';
        }

        function hideAllHeaderMessages() {
            headerSuccessMessage.style.display = 'none';
            headerErrorMessage.style.display = 'none';
            headerWarningMessage.style.display = 'none';
            headerInfoMessage.style.display = 'none';
        }

        function showHeaderMessage(type, message) {
            hideAllHeaderMessages();
            
            let targetElement;
            switch(type) {
                case 'success':
                    targetElement = headerSuccessMessage;
                    break;
                case 'error':
                    targetElement = headerErrorMessage;
                    break;
                case 'warning':
                    targetElement = headerWarningMessage;
                    break;
                case 'info':
                    targetElement = headerInfoMessage;
                    break;
                default:
                    return;
            }
            
            const messageText = targetElement.querySelector('.message-text');
            messageText.textContent = message;
            targetElement.style.display = 'block';
            
            // Auto-hide after 8 seconds
            setTimeout(() => {
                targetElement.style.display = 'none';
            }, 8000);
        }

        function hideHeaderMessage(messageId) {
            document.getElementById(messageId).style.display = 'none';
        }

        // Utility functions for showing messages
        function showSuccessMessage(message) {
            showHeaderMessage('success', message);
        }

        function showErrorMessage(message) {
            showHeaderMessage('error', message);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            headerErrorMessage.classList.add('shake');
            setTimeout(() => {
                headerErrorMessage.classList.remove('shake');
            }, 600);
        }

        function showWarningMessage(message) {
            showHeaderMessage('warning', message);
        }

        function showInfoMessage(message) {
            showHeaderMessage('info', message);
        }

        // Updated Election status functions
        // Updated Election status functions
        function updateElectionStatusDisplay() {
            if (currentElectionStatus === 'completed') {
                // Results have been declared
                statusIndicator.className = 'btn-status completed';
                statusIndicator.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    Results Declared
                `;
                
                updateResultButtons(true);
                
            } else if (currentElectionStatus === 'active') {
                // Election is active
                statusIndicator.className = 'btn-status active';
                statusIndicator.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Election Active
                `;
                
                // Initialize countdown
                initializeCountdown();
                
                // Check results status to update buttons appropriately
                checkResultsStatus();
                
            } else {
                // Election is inactive
                statusIndicator.className = 'btn-status inactive';
                statusIndicator.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    Election Inactive
                `;
                
                // Stop countdown
                stopCountdown();
                
                // Disable both buttons
                updateResultButtons(false);
            }
        }

        function isElectionActive() {
            return currentElectionStatus === 'active';
        }

        // Updated message constants
        const ELECTION_ACTIVE_MESSAGE = 'Editing is not allowed while the election is active.';

        // Voter Delete Modal Functions
        function showDeleteConfirmation(voterId, voterName, hasVoted) {
            if (isElectionActive()) {
                showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                return;
            }
            
            voterToDelete = { id: voterId, name: voterName, hasVoted: hasVoted };
            deleteConfirmationMessage.innerHTML = `
                Are you sure you want to delete voter <strong>"${voterName}"</strong>?<br><br>
                This action is permanent and cannot be reversed.
            `;
            deleteModal.classList.add('active');
        }

        function cancelDelete() {
            deleteModal.classList.remove('active');
            voterToDelete = null;
        }

        function executeDelete() {
            if (!voterToDelete) {
                cancelDelete();
                return;
            }

            const { id, name, hasVoted } = voterToDelete;

            const confirmBtn = document.getElementById('confirm-delete-btn');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                Deleting...
            `;

            fetch(`${apiBase}/admin/voters/${id}`, { 
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(async res => {
                let responseData = null;
                try { responseData = await res.json(); } catch {}
                if (!res.ok) {
                    const error = {
                        status: res.status,
                        statusText: res.statusText,
                        message: responseData?.message || responseData?.error || `HTTP ${res.status}: ${res.statusText}`,
                        data: responseData
                    };
                    throw error;
                }
                return responseData;
            })
            .then(data => {
                cancelDelete();
                showSuccessMessage(data?.message || `Voter "${name}" has been successfully deleted.`);
                loadVoters();
                loadVoterStats();
            })
            .catch(error => {
                cancelDelete();
                console.error('Error deleting voter:', error);
                showErrorMessage(getDeleteErrorMessage(error, error.status, voterToDelete, 'voter'));
                loadVoters();
                loadVoterStats();
            })
            .finally(() => {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalText;
                voterToDelete = null;
            });
        }

        // Candidate Delete Modal Functions
        function showCandidateDeleteConfirmation(candidateId, candidateName, voteCount) {
            if (isElectionActive()) {
                showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                return;
            }
            
            candidateToDelete = { id: candidateId, name: candidateName, voteCount: voteCount };
            candidateDeleteConfirmationMessage.innerHTML = `
                Are you sure you want to delete candidate <strong>"${candidateName}"</strong>?<br><br>
                This action is permanent and cannot be reversed.
            `;
            candidateDeleteModal.classList.add('active');
        }

        function cancelCandidateDelete() {
            candidateDeleteModal.classList.remove('active');
            candidateToDelete = null;
        }

        function executeCandidateDelete() {
            if (!candidateToDelete) {
                cancelCandidateDelete();
                return;
            }

            const { id, name, voteCount } = candidateToDelete;

            const confirmBtn = document.getElementById('confirm-candidate-delete-btn');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                Deleting...
            `;

            fetch(`${apiBase}/admin/candidates/${id}`, { 
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(async res => {
                let responseData = null;
                try { responseData = await res.json(); } catch {}
                if (!res.ok) {
                    const error = {
                        status: res.status,
                        statusText: res.statusText,
                        message: responseData?.message || responseData?.error || `HTTP ${res.status}: ${res.statusText}`,
                        data: responseData
                    };
                    throw error;
                }
                return responseData;
            })
            .then(data => {
                cancelCandidateDelete();
                showSuccessMessage(data?.message || `Candidate "${name}" has been successfully deleted.`);
                loadCandidates();
                loadCandidateStats();
            })
            .catch(error => {
                cancelCandidateDelete();
                console.error('Error deleting candidate:', error);
                showErrorMessage(getDeleteErrorMessage(error, error.status, candidateToDelete, 'candidate'));
                loadCandidates();
                loadCandidateStats();
            })
            .finally(() => {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalText;
                candidateToDelete = null;
            });
        }

        // Enhanced error message handler for delete operations
        function getDeleteErrorMessage(error, statusCode, itemInfo = null, itemType = 'voter') {
            if (statusCode === 500) {
                if (error.message && error.message.toLowerCase().includes('vote')) {
                    return itemInfo && (itemInfo.hasVoted || itemInfo.voteCount > 0) 
                        ? `Cannot delete ${itemType} "${itemInfo.name}" because they have already ${itemType === 'voter' ? 'cast their vote' : 'received votes'}. ${itemType === 'voter' ? 'Voters' : 'Candidates'} who have participated in the election cannot be removed from the system.`
                        : `This ${itemType} cannot be deleted because they have already participated in the voting process.`;
                }
                if (error.message && error.message.toLowerCase().includes('constraint')) {
                    return `Cannot delete this ${itemType} due to data integrity constraints. The ${itemType} may be referenced by other system records.`;
                }
                if (error.message && error.message.toLowerCase().includes('foreign')) {
                    return `Cannot delete this ${itemType} because they are associated with existing voting records or other system data.`;
                }
                return `Cannot delete this ${itemType} because they have already participated in the election.`;
            }
            
            if (statusCode === 403) {
                return `You do not have permission to delete this ${itemType}. Please contact your system administrator.`;
            }
            
            if (statusCode === 404) {
                return `${itemType.charAt(0).toUpperCase() + itemType.slice(1)} not found. They may have already been deleted or the ${itemType} ID is invalid.`;
            }
            
            if (statusCode === 409) {
                return `Cannot delete ${itemType} due to a conflict. The ${itemType} may be currently engaged in an active voting session.`;
            }

            if (statusCode >= 500) {
                return `Server error occurred while trying to delete the ${itemType}. Please try again later or contact support.`;
            }

            if (statusCode >= 400) {
                return `Invalid request. Please refresh the page and try again.`;
            }

            if (error.message && error.message.toLowerCase().includes('network')) {
                return `Network connection error. Please check your internet connection and try again.`;
            }

            return error.message || `An unexpected error occurred while deleting the ${itemType}. Please try again.`;
        }

        // Stats Management Functions
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function formatNumber(num) {
            if (num === null || num === undefined) return 'N/A';
            return new Intl.NumberFormat('en-US').format(num);
        }

        function showLoadingState(statKey, statsElements) {
            const stat = statsElements[statKey];
            if (!stat) return;
            
            stat.card.classList.add('loading');
            stat.value.textContent = 'Loading...';
            stat.error.style.display = 'none';
        }

        function hideLoadingState(statKey, statsElements) {
            const stat = statsElements[statKey];
            if (!stat) return;
            
            stat.card.classList.remove('loading');
        }

        function updateStatValue(statKey, value, statsElements, isError = false) {
            const stat = statsElements[statKey];
            if (!stat) return;

            hideLoadingState(statKey, statsElements);

            if (isError) {
                stat.value.textContent = 'Error';
                stat.value.style.color = '#e74c3c';
                stat.error.textContent = value;
                stat.error.style.display = 'block';
                stat.updated.textContent = '';
            } else {
                stat.value.textContent = formatNumber(value);
                stat.value.style.color = '#3498db';
                stat.error.style.display = 'none';
                stat.updated.textContent = formatTime(new Date());
            }
        }

        async function fetchStat(statKey, statsElements) {
            const stat = statsElements[statKey];
            if (!stat) return;

            showLoadingState(statKey, statsElements);

            try {
                const response = await fetch(`${apiBase}${stat.endpoint}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`Response for ${statKey}:`, data);
                
                // Handle different response formats
                let value;
                if (typeof data === 'number') {
                    value = data;
                } else if (data && typeof data.totalVoters === 'number') {
                    value = data.totalVoters;
                } else if (data && typeof data.votedSuccessfully === 'number') {
                    value = data.votedSuccessfully;
                } else if (data && typeof data.haventVoted === 'number') {
                    value = data.haventVoted;
                } else if (data && typeof data.totalCandidates === 'number') {
                    value = data.totalCandidates;
                } else if (data && typeof data.completedProfiles === 'number') {
                    value = data.completedProfiles;
                } else if (data && typeof data.incompleteProfiles === 'number') {
                    value = data.incompleteProfiles;
                } else if (data && typeof data.count === 'number') {
                    value = data.count;
                } else if (data && typeof data.total === 'number') {
                    value = data.total;
                } else if (data && typeof data.value === 'number') {
                    value = data.value;
                } else {
                    console.error('Unrecognized response format:', data);
                    throw new Error('Invalid response format - expected numeric value');
                }

                updateStatValue(statKey, value, statsElements);
                    
            } catch (error) {
                console.error(`Error fetching ${statKey}:`, error);
                updateStatValue(statKey, error.message, statsElements, true);
            }
        }

        function loadVoterStats() {
            console.log('Loading voter stats...');
            Object.keys(voterStatsElements).forEach(statKey => {
                fetchStat(statKey, voterStatsElements);
            });
        }

        function loadCandidateStats() {
            console.log('Loading candidate stats...');
            Object.keys(candidateStatsElements).forEach(statKey => {
                fetchStat(statKey, candidateStatsElements);
            });
        }

        function startAutoRefresh(type = 'voters') {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            refreshInterval = setInterval(() => {
                console.log(`Auto-refreshing ${type} stats...`);
                if (type === 'voters') {
                    loadVoterStats();
                } else if (type === 'candidates') {
                    loadCandidateStats();
                }
            }, REFRESH_INTERVAL);
            
            console.log(`Auto-refresh started for ${type} (${REFRESH_INTERVAL / 1000}s interval)`);
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
                console.log('Auto-refresh stopped');
            }
        }

        // Reset Election Settings Functions
        function showResetConfirmation() {
            resetConfirmModal.classList.add('active');
        }

        function cancelReset() {
            resetConfirmModal.classList.remove('active');
        }

        function executeReset() {
            const confirmBtn = confirmResetBtn;
            const originalText = confirmBtn.innerHTML;
            
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                Resetting...
            `;

            fetch(`${apiBase}/admin/election-settings/reset`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(async res => {
                let responseData = null;
                try { 
                    responseData = await res.json(); 
                } catch {}
                
                if (!res.ok) {
                    const error = {
                        status: res.status,
                        statusText: res.statusText,
                        message: responseData?.message || responseData?.error || `HTTP ${res.status}: ${res.statusText}`,
                        data: responseData
                    };
                    throw error;
                }
                return responseData;
            })
            .then(data => {
                cancelReset();
                showSuccessMessage(data?.message || 'Election settings have been reset successfully. All configuration data has been cleared.');
                
                setDefaultElectionValues();
                currentElectionStatus = 'inactive';
                hasElectionSettings = false;
                resultsAreDeclared = false;
                
                // Reset button states - remove permanent classes
                declareResultBtn.classList.remove('permanently-disabled');
                viewResultsBtn.classList.remove('permanently-enabled');
                
                stopCountdown();
                updateElectionStatusDisplay();
            })
            .catch(error => {
                cancelReset();
                console.error('Error resetting election settings:', error);
                
                let errorMessage = 'Failed to reset election settings. Please try again.';
                if (error.status === 404) {
                    errorMessage = 'Reset endpoint not available. The form has been reset locally.';
                    setDefaultElectionValues();
                    currentElectionStatus = 'inactive';
                    hasElectionSettings = false;
                    resultsAreDeclared = false;
                    
                    // Reset button states - remove permanent classes
                    declareResultBtn.classList.remove('permanently-disabled');
                    viewResultsBtn.classList.remove('permanently-enabled');
                    
                    stopCountdown();
                    updateElectionStatusDisplay();
                    showWarningMessage(errorMessage);
                    return;
                } else if (error.status >= 500) {
                    errorMessage = 'Server error occurred while resetting settings. Please try again later.';
                } else if (error.message) {
                    errorMessage = `Reset failed: ${error.message}`;
                }
                
                showErrorMessage(errorMessage);
            })
            .finally(() => {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalText;
            });
        }

        // Declare(Enhanced) Result Function
        async function declareResults() {
            if (!isElectionTimeEnded) {
                showErrorMessage('Results can only be declared after the election period has ended.');
                return;
            }

            if (currentElectionStatus !== 'active') {
                showErrorMessage('Results can only be declared for an active election.');
                return;
            }

            // Check current status first
            const currentStatus = await checkResultsStatus();
            if (currentStatus) {
                showWarningMessage('Results have already been declared.');
                return;
            }

            if (!confirm('Are you sure you want to declare the election results? This action will make the results public and cannot be undone.')) {
                return;
            }

            const originalText = declareResultBtn.innerHTML;
            declareResultBtn.disabled = true;
            declareResultBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                Declaring Results...
            `;

            try {
                const response = await fetch(`${apiBase}/admin/declare-results`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to declare results');
                }

                const data = await response.json();
                
                // Verify results were declared by checking API again
                const finalStatus = await checkResultsStatus();
                
                if (finalStatus) {
                    currentElectionStatus = 'completed';
                    resultsAreDeclared = true;
                    updateElectionStatusDisplay();
                    showSuccessMessage(data?.message || 'Election results have been declared successfully!');
                } else {
                    throw new Error('Results declaration may not have completed properly');
                }
                
            } catch (error) {
                console.error('Error declaring results:', error);
                showErrorMessage('Failed to declare results. Please try again.');
                
                // Restore button state on error
                declareResultBtn.disabled = false;
                declareResultBtn.innerHTML = originalText;
                
                // Double-check status in case it partially succeeded
                checkResultsStatus();
            }
        }

        // View Results Function
        async function viewResults() {
            // Check current results status
            const resultsDeclared = await checkResultsStatus();
            
            if (!resultsDeclared && !viewResultsBtn.classList.contains('permanently-enabled')) {
                showErrorMessage('Results have not been declared yet.');
                return;
            }
            
            // Redirect to results page
            window.location.href = 'result.html';
        }

        // Logout functions
        function showLogoutConfirmation() {
            document.getElementById('logout-modal').classList.add('active');
        }

        function cancelLogout() {
            document.getElementById('logout-modal').classList.remove('active');
        }

        function confirmLogout() {
            document.getElementById('logout-modal').classList.remove('active');
            
            const loadingOverlay = document.createElement('div');
            loadingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(52, 152, 219, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                color: white;
                font-size: 1.2rem;
                font-weight: 600;
            `;
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="margin-bottom: 1rem;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                            <path d="M21 12a9 9 0 11-6.219-8.56"/>
                        </svg>
                    </div>
                    <div>Logging you out...</div>
                </div>
                <style>
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            document.body.appendChild(loadingOverlay);
            
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1500);
        }

        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const contentSections = document.querySelectorAll('.content-section');

            // Tab switching functionality
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    navTabs.forEach(t => t.classList.remove('active'));
                    contentSections.forEach(s => s.classList.remove('active'));
                    
                    this.classList.add('active');
                    
                    const sectionId = this.getAttribute('data-section');
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }

                    // Load data and start/stop auto-refresh based on active section
                    if (sectionId === 'voters') {
                        loadVoters();
                        loadVoterStats();
                        startAutoRefresh('voters');
                    } else if (sectionId === 'candidates') {
                        loadCandidates();
                        loadCandidateStats();
                        startAutoRefresh('candidates');
                    } else if (sectionId === 'election') {
                        loadElectionSettings();
                        stopAutoRefresh();
                    } else {
                        stopAutoRefresh();
                    }
                });
            });

            // Election form handling
            const electionForm = document.getElementById('election-form');

            if (electionForm) {
                electionForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        name: document.getElementById('election-name').value,
                        type: document.getElementById('election-type').value,
                        startDate: document.getElementById('start-date').value,
                        endDate: document.getElementById('end-date').value,
                        startTime: document.getElementById('start-time').value,
                        endTime: document.getElementById('end-time').value,
                        status: 'active' // Automatically set to active when election is configured
                    };

                    // Validate
                    if (!formData.name || !formData.startDate || !formData.endDate) {
                        showErrorMessage('Please fill in all required fields.');
                        return;
                    }

                    // Validate date/time logic
                    const startDateTime = new Date(`${formData.startDate}T${formData.startTime || '00:00'}`);
                    const endDateTime = new Date(`${formData.endDate}T${formData.endTime || '23:59'}`);
                    
                    if (startDateTime >= endDateTime) {
                        showErrorMessage('End date and time must be after start date and time.');
                        return;
                    }

                    try {
                        const response = await fetch(`${apiBase}/admin/election-settings`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        if (!response.ok) {
                            throw new Error('Failed to save settings');
                        }

                        const result = await response.json();
                        
                        // Update local status
                        currentElectionStatus = 'active';
                        hasElectionSettings = true;
                        resultsAreDeclared = false;
                        
                        // Initialize countdown
                        electionEndTime = new Date(`${formData.endDate}T${formData.endTime}`).getTime();
                        const now = new Date().getTime();
                        isElectionTimeEnded = now > electionEndTime;
                        
                        updateElectionStatusDisplay();
                        
                        showSuccessMessage('Election settings saved successfully! Election is now active.');
                        
                    } catch (error) {
                        console.error('Error:', error);
                        showErrorMessage('Failed to save election settings. Please try again.');
                    }
                });
            }

            // Declare result button event listener
            if (declareResultBtn) {
                declareResultBtn.addEventListener('click', declareResults);
            }

            // View results button event listener
            if (viewResultsBtn) {
                viewResultsBtn.addEventListener('click', viewResults);
            }

            // Reset form button functionality
            if (resetFormBtn) {
                resetFormBtn.addEventListener('click', function() {
                    showResetConfirmation();
                });
            }

            // Reset modal event listeners
            if (confirmResetBtn) {
                confirmResetBtn.addEventListener('click', executeReset);
            }

            if (cancelResetBtn) {
                cancelResetBtn.addEventListener('click', cancelReset);
            }

            // Form validation
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            const startTimeInput = document.getElementById('start-time');
            const endTimeInput = document.getElementById('end-time');

            function validateDates() {
                const startDate = new Date(startDateInput.value + 'T' + (startTimeInput.value || '00:00'));
                const endDate = new Date(endDateInput.value + 'T' + (endTimeInput.value || '23:59'));
                
                if (startDate >= endDate) {
                    showWarningMessage('End date and time must be after start date and time');
                    return false;
                }
                
                // Update election completion status when dates change
                const now = new Date();
                electionEndTime = endDate.getTime();
                isElectionTimeEnded = now.getTime() > electionEndTime;
                
                // Reinitialize countdown if election is active
                if (currentElectionStatus === 'active') {
                    initializeCountdown();
                }
                
                updateElectionStatusDisplay();
                
                return true;
            }

            if (startDateInput && endDateInput) {
                startDateInput.addEventListener('change', validateDates);
                endDateInput.addEventListener('change', validateDates);
                if (startTimeInput) startTimeInput.addEventListener('change', validateDates);
                if (endTimeInput) endTimeInput.addEventListener('change', validateDates);
            }

            // Set current date as minimum for date inputs
            const today = new Date().toISOString().split('T')[0];
            if (startDateInput) startDateInput.setAttribute('min', today);
            if (endDateInput) endDateInput.setAttribute('min', today);

            // Initialize form inputs styling
            const formInputs = document.querySelectorAll('.form-input');
            formInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#3498db';
                    this.style.boxShadow = '0 0 0 3px rgba(52,152,219,0.1)';
                });

                input.addEventListener('blur', function() {
                    this.style.borderColor = '#d0d7de';
                    this.style.boxShadow = 'none';
                });
            });

            console.log('Votezy Admin Panel initialized successfully');
            
            // Initialize voter management and stats
            if (voterTableBody) {
                loadVoters();
            }

            // Load voter stats initially and start auto-refresh
            loadVoterStats();
            startAutoRefresh('voters');

            // Load election settings and check status
            loadElectionSettings();

            // Handle page visibility changes
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    stopAutoRefresh();
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                    }
                } else {
                    // Reload stats when page becomes visible again
                    const activeSection = document.querySelector('.content-section.active');
                    if (activeSection) {
                        const sectionId = activeSection.id;
                        if (sectionId === 'voters') {
                            loadVoterStats();
                            startAutoRefresh('voters');
                        } else if (sectionId === 'candidates') {
                            loadCandidateStats();
                            startAutoRefresh('candidates');
                        }
                    }
                    // Refresh election status and restart countdown if needed
                    checkElectionStatus();
                    if (currentElectionStatus === 'active' && !isElectionTimeEnded) {
                        initializeCountdown();
                    }
                }
            });
        });

        // Set default election values function
        function setDefaultElectionValues() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);

            document.getElementById('election-name').value = '';
            document.getElementById('election-type').value = 'general';
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            document.getElementById('start-time').value = '08:00';
            document.getElementById('end-time').value = '18:00';

            // Reset status
            currentElectionStatus = 'inactive';
            hasElectionSettings = false;
            resultsAreDeclared = false;
            electionEndTime = null;
            isElectionTimeEnded = false;
            stopCountdown();
            updateElectionStatusDisplay();
        }

        // Election status check function
        // Election status check function
        async function checkElectionStatus() {
            try {
                const response = await fetch(`${apiBase}/election-settings`);
                if (response.ok) {
                    const data = await response.json();
                    
                    // Check if we have election settings
                    if (data && data.name) {
                        hasElectionSettings = true;
                        
                        // Set election start and end times
                        if (data.startDate && data.startTime) {
                            electionStartTime = new Date(`${data.startDate}T${data.startTime}`).getTime();
                        }
                        if (data.endDate && data.endTime) {
                            electionEndTime = new Date(`${data.endDate}T${data.endTime}`).getTime();
                            const now = new Date().getTime();
                            isElectionTimeEnded = now > electionEndTime;
                        }
                        
                        // Check results status first
                        const resultsStatus = await checkResultsStatus();
                        
                        // Update status based on results and time
                        if (resultsStatus) {
                            currentElectionStatus = 'completed';
                            resultsAreDeclared = true;
                        } else if (data.status === 'active' && hasElectionSettings) {
                            currentElectionStatus = 'active';
                            resultsAreDeclared = false;
                        } else {
                            currentElectionStatus = 'inactive';
                            resultsAreDeclared = false;
                        }
                    } else {
                        hasElectionSettings = false;
                        currentElectionStatus = 'inactive';
                        resultsAreDeclared = false;
                    }
                    
                    updateElectionStatusDisplay();
                    return currentElectionStatus;
                }
            } catch (error) {
                console.error('Error checking election status:', error);
                hasElectionSettings = false;
                currentElectionStatus = 'inactive';
                resultsAreDeclared = false;
                updateElectionStatusDisplay();
            }
            return 'inactive';
        }

        // Voter Management Functions
        function loadVoters() {
            fetch(`${apiBase}/admin/voters`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    voterTableBody.innerHTML = '';
                    data.forEach(voter => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${voter.id}</td>
                            <td>${voter.name}</td>
                            <td>${voter.username}</td>
                            <td>${voter.hasVoted ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="edit-btn" data-id="${voter.id}" ${isElectionActive() ? 'disabled title="Cannot edit during active election"' : ''}>Edit</button>
                                <button class="delete-btn" data-id="${voter.id}" data-name="${voter.name}" data-voted="${voter.hasVoted}" ${isElectionActive() ? 'disabled title="Cannot delete during active election"' : ''}>Delete</button>
                            </td>
                        `;
                        voterTableBody.appendChild(tr);
                    });
                   
                    attachVoterListeners();
                })
                .catch(err => {
                    console.error('Error loading voters:', err);
                    showErrorMessage('Failed to load voters: ' + err.message);
                });
        }

        // Candidate Management Functions
        function loadCandidates() {
            fetch(`${apiBase}/admin/candidates`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    candidateTableBody.innerHTML = '';
                    data.forEach(candidate => {
                        const tr = document.createElement('tr');
                        
                        const isCompleted = candidate.status === "Completed";
                        const statusClass = isCompleted ? 'status-active' : 'status-inactive';
                        const statusText = isCompleted ? 'Complete' : 'Incomplete';
                        
                        tr.innerHTML = `
                            <td>${candidate.id}</td>
                            <td>${candidate.name || 'N/A'}</td>
                            <td>${candidate.username || 'N/A'}</td>
                            <td>${candidate.partyName || 'N/A'}</td>
                            <td>${candidate.symbol || 'N/A'}</td>
                            <td>
                                <span class="election-status ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td>${candidate.voteCount || 0}</td>
                            <td>
                                <button class="candidate-edit-btn" data-id="${candidate.id}" ${isElectionActive() ? 'disabled title="Cannot edit during active election"' : ''}>Edit</button>
                                <button class="candidate-delete-btn" data-id="${candidate.id}" data-name="${candidate.name || 'N/A'}" data-votes="${candidate.voteCount || 0}" ${isElectionActive() ? 'disabled title="Cannot delete during active election"' : ''}>Delete</button>
                            </td>
                        `;
                        candidateTableBody.appendChild(tr);
                    });
                    
                    attachCandidateListeners();
                })
                .catch(err => {
                    console.error('Error loading candidates:', err);
                    showErrorMessage('Failed to load candidates: ' + err.message);
                });
        }

        function attachVoterListeners() {
            document.querySelectorAll('.edit-btn').forEach(btn =>
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (isElectionActive()) {
                        showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                        return;
                    }
                    openEditModal(btn.getAttribute('data-id'));
                })
            );
            document.querySelectorAll('.delete-btn').forEach(btn =>
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (isElectionActive()) {
                        showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                        return;
                    }
                    const id = btn.getAttribute('data-id');
                    const name = btn.getAttribute('data-name');
                    const hasVoted = btn.getAttribute('data-voted') === 'true';
                    showDeleteConfirmation(id, name, hasVoted);
                })
            );
        }

        function attachCandidateListeners() {
            document.querySelectorAll('.candidate-edit-btn').forEach(btn =>
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (isElectionActive()) {
                        showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                        return;
                    }
                    openCandidateEditModal(btn.getAttribute('data-id'));
                })
            );
            document.querySelectorAll('.candidate-delete-btn').forEach(btn =>
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (isElectionActive()) {
                        showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                        return;
                    }
                    const id = btn.getAttribute('data-id');
                    const name = btn.getAttribute('data-name');
                    const voteCount = parseInt(btn.getAttribute('data-votes') || '0');
                    showCandidateDeleteConfirmation(id, name, voteCount);
                })
            );
        }

        function openEditModal(id) {
            if (isElectionActive()) {
                showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                return;
            }
            
            fetch(`${apiBase}/admin/voters/${id}`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(voter => {
                    editVoterId.value = id;
                    editFullName.value = voter.name;
                    editUsername.value = voter.username;
                    showModal();
                })
                .catch(err => {
                    console.error('Error fetching voter:', err);
                    showErrorMessage('Failed to fetch voter data: ' + err.message);
                });
        }

        function openCandidateEditModal(id) {
            if (isElectionActive()) {
                showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                return;
            }
            
            fetch(`${apiBase}/admin/candidates/${id}`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(candidate => {
                    editCandidateId.value = id;
                    editCandidateName.value = candidate.name || '';
                    editCandidateUsername.value = candidate.username || '';
                    showCandidateModal();
                })
                .catch(err => {
                    console.error('Error fetching candidate:', err);
                    showErrorMessage('Failed to fetch candidate data: ' + err.message);
                });
        }

        function showModal() {
            editModal.style.display = 'block';
            modalOverlay.style.display = 'block';
        }

        function hideModal() {
            editModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }

        function showCandidateModal() {
            editCandidateModal.style.display = 'block';
            candidateModalOverlay.style.display = 'block';
        }

        function hideCandidateModal() {
            editCandidateModal.style.display = 'none';
            candidateModalOverlay.style.display = 'none';
        }

        if (cancelBtn) cancelBtn.onclick = hideModal;
        if (modalOverlay) modalOverlay.onclick = hideModal;
        if (cancelCandidateBtn) cancelCandidateBtn.onclick = hideCandidateModal;
        if (candidateModalOverlay) candidateModalOverlay.onclick = hideCandidateModal;

        // Modal setup
        const editConfirmModal = document.getElementById('edit-confirm-modal');
        const editConfirmationMessage = document.getElementById('edit-confirmation-message');
        const confirmEditBtn = document.getElementById('confirm-edit-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');

        const candidateEditConfirmModal = document.getElementById('candidate-edit-confirm-modal');
        const candidateEditConfirmationMessage = document.getElementById('candidate-edit-confirmation-message');
        const confirmCandidateEditBtn = document.getElementById('confirm-candidate-edit-btn');
        const cancelCandidateEditBtn = document.getElementById('cancel-candidate-edit-btn');

        let pendingEditData = null;
        let pendingCandidateEditData = null;

        // Voter Edit Form Handler
        if (editForm) {
            editForm.addEventListener('submit', e => {
                e.preventDefault();

                if (isElectionActive()) {
                    showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                    hideModal();
                    return;
                }

                const id = editVoterId.value;
                const updated = {
                    fullName: editFullName.value.trim(),
                    username: editUsername.value.trim()
                };

                if (!updated.fullName || !updated.username) {
                    showErrorMessage('Please fill in all required fields.');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(updated.username)) {
                    showErrorMessage('Please enter a valid email address for username.');
                    return;
                }

                pendingEditData = { id, updated };
                editConfirmationMessage.innerHTML = `
                    Are you sure you want to update voter details?<br>
                    <strong>Full Name:</strong> ${updated.fullName}<br>
                    <strong>Username (Email):</strong> ${updated.username}
                `;
                editConfirmModal.classList.add('active');
            });
        }

        // Candidate Edit Form Handler
        if (editCandidateForm) {
            editCandidateForm.addEventListener('submit', e => {
                e.preventDefault();

                if (isElectionActive()) {
                    showErrorMessage(ELECTION_ACTIVE_MESSAGE);
                    hideCandidateModal();
                    return;
                }

                const id = editCandidateId.value;
                const updated = {
                    fullName: editCandidateName.value.trim(),
                    username: editCandidateUsername.value.trim()
                };

                if (!updated.fullName || !updated.username) {
                    showErrorMessage('Please fill in all required fields.');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(updated.username)) {
                    showErrorMessage('Please enter a valid email address for username.');
                    return;
                }

                pendingCandidateEditData = { id, updated };
                candidateEditConfirmationMessage.innerHTML = `
                    Are you sure you want to update candidate details?<br>
                    <strong>Full Name:</strong> ${updated.fullName}<br>
                    <strong>Username (Email):</strong> ${updated.username}
                `;
                candidateEditConfirmModal.classList.add('active');
            });
        }

        // Edit Confirmation Handlers
        if (confirmEditBtn) {
            confirmEditBtn.onclick = function() {
                editConfirmModal.classList.remove('active');
                if (!pendingEditData) return;

                const { id, updated } = pendingEditData;

                confirmEditBtn.disabled = true;
                const originalText = confirmEditBtn.textContent;
                confirmEditBtn.textContent = 'Saving...';

                fetch(`${apiBase}/admin/voters/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updated)
                })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(response => {
                    showSuccessMessage('Voter updated successfully!');
                    hideModal();
                    loadVoters();
                    loadVoterStats();
                })
                .catch(err => {
                    console.error('Error updating voter:', err);
                    showErrorMessage('Failed to update voter: ' + err.message);
                })
                .finally(() => {
                    pendingEditData = null;
                    confirmEditBtn.disabled = false;
                    confirmEditBtn.textContent = originalText;
                });
            };
        }

        if (confirmCandidateEditBtn) {
            confirmCandidateEditBtn.onclick = function() {
                candidateEditConfirmModal.classList.remove('active');
                if (!pendingCandidateEditData) return;

                const { id, updated } = pendingCandidateEditData;

                confirmCandidateEditBtn.disabled = true;
                const originalText = confirmCandidateEditBtn.textContent;
                confirmCandidateEditBtn.textContent = 'Saving...';

                fetch(`${apiBase}/admin/candidates/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updated)
                })
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(response => {
                    showSuccessMessage('Candidate updated successfully!');
                    hideCandidateModal();
                    loadCandidates();
                    loadCandidateStats();
                })
                .catch(err => {
                    console.error('Error updating candidate:', err);
                    showErrorMessage('Failed to update candidate: ' + err.message);
                })
                .finally(() => {
                    pendingCandidateEditData = null;
                    confirmCandidateEditBtn.disabled = false;
                    confirmCandidateEditBtn.textContent = originalText;
                });
            };
        }

        if (cancelEditBtn) {
            cancelEditBtn.onclick = function() {
                editConfirmModal.classList.remove('active');
                pendingEditData = null;
            };
        }

        if (cancelCandidateEditBtn) {
            cancelCandidateEditBtn.onclick = function() {
                candidateEditConfirmModal.classList.remove('active');
                pendingCandidateEditData = null;
            };
        }

        // Election Settings Integration
        const apiElectionSettings = `${apiBase}/election-settings`;

        function fillElectionForm(data) {
            if (!data) return;
            
            document.getElementById('election-name').value = data.name || '';
            document.getElementById('election-type').value = data.type || 'general';
            document.getElementById('start-date').value = data.startDate || '';
            document.getElementById('end-date').value = data.endDate || '';
            document.getElementById('start-time').value = data.startTime || '08:00';
            document.getElementById('end-time').value = data.endTime || '18:00';

            // Update status and check if we have settings
            if (data.name) {
                hasElectionSettings = true;
                
                // Check if results have been declared
                if (data.status === 'completed' || data.resultsPublished) {
                    currentElectionStatus = 'completed';
                    resultsAreDeclared = true;
                } else if (data.status === 'active') {
                    currentElectionStatus = 'active';
                    resultsAreDeclared = false;
                } else {
                    currentElectionStatus = 'active'; // Default to active if election is configured
                    resultsAreDeclared = false;
                }
            } else {
                hasElectionSettings = false;
                currentElectionStatus = 'inactive';
                resultsAreDeclared = false;
            }
            
            // Check if election time has ended and set election end time
            const now = new Date();
            const endDate = data.endDate;
            const endTime = data.endTime;
            
            if (endDate && endTime) {
                electionEndTime = new Date(`${endDate}T${endTime}`).getTime();
                isElectionTimeEnded = now.getTime() > electionEndTime;
            }
            
            updateElectionStatusDisplay();
        }

        function loadElectionSettings() {
            fetch(apiElectionSettings)
                .then(res => {
                    if (res.status === 404) {
                        console.log('Election settings endpoint not found - using defaults');
                        setDefaultElectionValues();
                        return null;
                    }
                    if (!res.ok) {
                        throw new Error(`Failed to fetch election settings: HTTP ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    if (data) {
                        fillElectionForm(data);
                    }
                })
                .catch(err => {
                    console.error('Error loading election settings:', err);
                    if (!err.message.includes('404')) {
                        showWarningMessage('Could not load election settings from server. Using default values.');
                    }
                    setDefaultElectionValues();
                });
        }

        function initializeCandidateSection() {
            loadCandidates();
            loadCandidateStats();
        }

        // Cleanup when page unloads
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
            stopCountdown();
        });
    </script>
</body>
</html>